<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title></title>
    <!-- 引入 Bootstrap CDN -->
    <link rel="stylesheet" href="../static/bootstrap-4.0.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/normal.css">
    <link rel="stylesheet" href="../static/css/style.css">
    <script src="../static/bootstrap-4.0.0/dist/js/bootstrap.js"></script>
    <script src="../static/js/jquery.js"></script>
    <script src="../static/js/selfjs.js"></script>
    <script src="../static/js/jquery.cookie.js"></script>
</head>
<body>
    <div class="container max-w-7xl pt-5 pb-12 mb-12">
        <div class="gradient-line">
        </div>
        <div class="row">
            <div class="col" style="display: flex; align-items: center; justify-content: center;">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 124.8372 55.2489" class="logo">
                    <style>
                        .draw-path {
                            --length: 100;
                            stroke-dasharray: var(--length) var(--length);
                            stroke-dashoffset: var(--path-from);
                            filter: blur(10px);
                            fill: none;
                            animation: draw 1.5s infinite ease-in-out;
                        }
    
                        .u-path {
                            --path-from: calc(var(--length) * 3px);
                            --path-to: var(--length);
                        }
    
                        .seven-path {
                            --path-from: calc(var(--length) * -3px);
                            --path-to: calc(var(--length) * -1px);
                            animation-delay: 0.4s;
                        }
    
                        @keyframes draw {
                            from {
                                stroke-dashoffset: var(--path-from);
                            }
    
                            to {
                                stroke-dashoffset: var(--path-to);
                                opacity: 0;
                            }
                        }
                    </style>
                    <defs>
                        <linearGradient id="seven-gradient" gradientUnits="userSpaceOnUse" x1="23.5345" y1="27.9014" x2="121.9345" y2="27.9014" gradientTransform="matrix(1 0 0 -1 0 55.8028)">
                            <stop offset="0" style="stop-color: #f0ebab" />
                            <stop offset="0.4" style="stop-color: #f3b4ce" />
                            <stop offset="1" style="stop-color: #96cfca" />
                        </linearGradient>
                        <clipPath id="clip-seven">
                            <path d="M102.2345,2.9014v9.8h9.6v23.6l-65.3-33.3l-0.3-0.1h-22.7l32.4,16.3l66,33.7v-50H102.2345z" />
                        </clipPath>
                        <clipPath id="clip-u">
                            <path d="M52.3345,38.5014c0,2.2091-1.7909,4-4,4h-31.6c-2.2091,0-4-1.7909-4-4v-35.6h-9.8v35.6c0,7.7,6.2,13.9,13.8,13.9h31.6c7.6,0,13.8-6.2,13.8-13.9v-8.1l-9.8-5V38.5014z" />
                        </clipPath>
                    </defs>
    
                    <g fill="rgba(255,255,255,0.08)">
                        <path d="M102.2345,2.9014v9.8h9.6v23.6l-65.3-33.3l-0.3-0.1h-22.7l32.4,16.3l66,33.7v-50H102.2345z" />
                        <path d="M52.3345,38.5014c0,2.2091-1.7909,4-4,4h-31.6c-2.2091,0-4-1.7909-4-4v-35.6h-9.8v35.6c0,7.7,6.2,13.9,13.8,13.9h31.6c7.6,0,13.8-6.2,13.8-13.9v-8.1l-9.8-5V38.5014z" />
                    </g>
    
                    <path clip-path="url(#clip-seven)" class="draw-path seven-path" stroke="url(#seven-gradient)" stroke-width="11" stroke-miterlimit="10" d="M102.0318,7.8102h14.9001v36.7666L25.5799-1.9312" pathLength="100" />
                    <path clip-path="url(#clip-u)" class="draw-path u-path" stroke="#fff" stroke-width="11" stroke-miterlimit="10" d="M7.8842,2.7939l0.0451,35.4694c0,5.0171,3.8335,9.0363,8.8506,9.0363h31.1442c5.0171,0,9.0843-4.0672,9.0843-9.0843V24.9046" pathLength="100" />
                    <path clip-path="url(#clip-seven)" class="draw-path seven-path" stroke="url(#seven-gradient)" stroke-width="11" stroke-miterlimit="10" d="M102.0318,7.8102h14.9001v36.7666L25.5799-1.9312" pathLength="100" />
                    <path clip-path="url(#clip-u)" class="draw-path u-path" stroke="#fff" stroke-width="11" stroke-miterlimit="10" d="M7.8842,2.7939l0.0451,35.4694c0,5.0171,3.8335,9.0363,8.8506,9.0363h31.1442c5.0171,0,9.0843-4.0672,9.0843-9.0843V24.9046" pathLength="100" />
                    <path clip-path="url(#clip-seven)" class="draw-path seven-path" stroke="url(#seven-gradient)" stroke-width="11" stroke-miterlimit="10" d="M102.0318,7.8102h14.9001v36.7666L25.5799-1.9312" pathLength="100" />
                    <path clip-path="url(#clip-u)" class="draw-path u-path" stroke="#fff" stroke-width="11" stroke-miterlimit="10" d="M7.8842,2.7939l0.0451,35.4694c0,5.0171,3.8335,9.0363,8.8506,9.0363h31.1442c5.0171,0,9.0843-4.0672,9.0843-9.0843V24.9046" pathLength="100" />
                </svg>
                <h1 style="display: inline-block; font-size: 2.5rem;">恶意代码检测平台</h1>
            </div>
        </div>
        <div class="row g-4 mt-3">
            <div class="col-lg-12">
                <div class="gradient-border-card">
                    <div class="modal-header">
                        <div class="modal-logo">
                            <span class="logo-circle">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="419.116" viewBox="0 0 512 419.116">
                                    <defs>
                                        <clipPath id="clip-folder-new">
                                            <rect width="512" height="419.116" />
                                        </clipPath>
                                    </defs>
                                    <g id="folder-new" clip-path="url(#clip-folder-new)">
                                        <path id="Union_1" data-name="Union 1" d="M16.991,419.116A16.989,16.989,0,0,1,0,402.125V16.991A16.989,16.989,0,0,1,16.991,0H146.124a17,17,0,0,1,10.342,3.513L227.217,57.77H437.805A16.989,16.989,0,0,1,454.8,74.761v53.244h40.213A16.992,16.992,0,0,1,511.6,148.657L454.966,405.222a17,17,0,0,1-16.6,13.332H410.053v.562ZM63.06,384.573H424.722L473.86,161.988H112.2Z" fill="var(--c-action-primary)" stroke="" stroke-width="1" />
                                    </g>
                                </svg>
                            </span>
                        </div>
                        <button class="btn-close">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" fill="var(--c-text-secondary)"/></svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h2 class="modal-title">文件上传检测</h2>
                        <p class="modal-description">Attach the file below</p>
                        <button class="upload-area" id="uploadButton">
                            <span class="upload-area-icon">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="340.531" height="419.116" viewBox="0 0 340.531 419.116">
                  <g id="files-new" clip-path="url(#clip-files-new)">
                    <path id="Union_2" data-name="Union 2" d="M-2904.708-8.885A39.292,39.292,0,0,1-2944-48.177V-388.708A39.292,39.292,0,0,1-2904.708-428h209.558a13.1,13.1,0,0,1,9.3,3.8l78.584,78.584a13.1,13.1,0,0,1,3.8,9.3V-48.177a39.292,39.292,0,0,1-39.292,39.292Zm-13.1-379.823V-48.177a13.1,13.1,0,0,0,13.1,13.1h261.947a13.1,13.1,0,0,0,13.1-13.1V-323.221h-52.39a26.2,26.2,0,0,1-26.194-26.195v-52.39h-196.46A13.1,13.1,0,0,0-2917.805-388.708Zm146.5,241.621a14.269,14.269,0,0,1-7.883-12.758v-19.113h-68.841c-7.869,0-7.87-47.619,0-47.619h68.842v-18.8a14.271,14.271,0,0,1,7.882-12.758,14.239,14.239,0,0,1,14.925,1.354l57.019,42.764c.242.185.328.485.555.671a13.9,13.9,0,0,1,2.751,3.292,14.57,14.57,0,0,1,.984,1.454,14.114,14.114,0,0,1,1.411,5.987,14.006,14.006,0,0,1-1.411,5.973,14.653,14.653,0,0,1-.984,1.468,13.9,13.9,0,0,1-2.751,3.293c-.228.2-.313.485-.555.671l-57.019,42.764a14.26,14.26,0,0,1-8.558,2.847A14.326,14.326,0,0,1-2771.3-147.087Z" transform="translate(2944 428)" fill="var(--c-action-primary)"/>
                  </g>
                </svg>
                            </span>
                            <span class="upload-area-title">点击或拖动文件到框中上传</span>
                            <span class="upload-area-description">
                                Alternatively, you can select a file by <br/><strong>clicking here</strong>
                            </span>
                        </button>
                       <input type="file" id="fileInput" style="display: none;" multiple />
                    </div>
                    <div class="shimmer" style="--delay: -6s"></div>
                    <i aria-hidden="true"></i>
                    <div class="glowing-wrapper glowing-wrapper-active mt-3">
                        <div class="glowing-wrapper-animations">
                            <div class="glowing-wrapper-glow"></div>
                            <div class="glowing-wrapper-mask-wrapper">
                                <div class="glowing-wrapper-mask"></div>
                            </div>
                        </div>
                        <div class="glowing-wrapper-borders-masker">
                            <div class="glowing-wrapper-borders"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12" style="margin-top: 20px;">
                <div class="gradient-border-card">
                    <h2>检测结果查询</h2>
                    <div class="container">
                        <div class="header_wrap">
                          <div class="num_rows">
                          
                                  <div class="form-group"> 	<!--		Show Numbers Of Rows 		-->
                                       <select class  ="form-control" name="state" id="maxRows">
                                           
                                           
                                           <option value="10">10</option>
                                           <option value="20">20</option>
                                           <option value="30">30</option>
                                           <option value="40">40</option>
                                           <option value="100">100</option>
                              <option value="5000">Show ALL Rows</option>
                                          </select>
                                       
                                    </div>
                          </div>
                          <div class="tb_search">
                  <input type="text" id="search_input_all" onkeyup="FilterkeyWord_all_table()" placeholder="Search.." class="form-control">
                          </div>
                        </div>
                  <table class="table table-class" id= "table-id">
                  <thead>
                  <tr>
                         <th>ID</th>
                          <th>文件名</th>
                          <th>文件类型</th>
                          <th>检测结果</th>
                          <th>MD5</th>
                          <th>日期</th>
                      </tr>
                    </thead>
                  <tbody class="asdfasdf">
                      
                      <tbody>
                  </table>
                  
                  <!--		Start Pagination -->
                              <div class='pagination-container'>
                                  <nav>
                                    <ul class="pagination">
                                     <!--	Here the JS Function Will Add the Rows -->
                                    </ul>
                                  </nav>
                              </div>
{#                        <div class="rows_count">Showing entries</div>#}
                  
                  </div> <!-- 		End of Container -->
                  
                  
                  
                  <!--  Developed By Yasser Mas -->
                    <div class="shimmer" style="--delay: -4s"></div>
                </div>
            </div> 
        </div>
    
        <div class="max-w-sm mx-auto grid gap-6 lg:grid-cols-3 items-start lg:max-w-none group mt-3" data-spotlight>
            <!-- Card 3 -->
            <div class="relative h-full bg-gray-800 rounded-xl p-px before:absolute before:w-80 before:h-80 before:-left-40 before:-top-40 before:bg-gray-400 before:rounded-full before:opacity-0 before:pointer-events-none before:transition-opacity before:duration-500 before:translate-x-[var(--mouse-x)] before:translate-y-[var(--mouse-y)] before:group-hover:opacity-100 before:z-10 before:blur-[100px] after:absolute after:w-96 after:h-96 after:-left-48 after:-top-48 after:bg-indigo-500 after:rounded-full after:opacity-0 after:pointer-events-none after:transition-opacity after:duration-500 after:translate-x-[var(--mouse-x)] after:translate-y-[var(--mouse-y)] after:hover:opacity-10 after:z-30 after:blur-[100px] overflow-hidden">
                <div class="relative h-full bg-gray-900 p-6 pb-8 rounded-[inherit] z-20 overflow-hidden">
                    <!-- Radial gradient -->
                    <div class="absolute bottom-0 translate-y-1/2 left-1/2 -translate-x-1/2 pointer-events-none -z-10 w-1/2 aspect-square" aria-hidden="true">
                        <div class="absolute inset-0 translate-z-0 bg-gray-800 rounded-full blur-[80px]"></div>
                    </div>
                    <div class="flex flex-col h-full">
                        <div class="icon mb-3">
                            <svg aria-labelledby="observability-icon-title" fill="none" height="28" role="img" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg">
                                <title id="observability-icon-title">
                                    An icon of a bar chart
                                </title>
                                <defs>
                                    <linearGradient gradientUnits="userSpaceOnUse" id="icon-gradient-fill" x1="4" x2="40" y1="4" y2="24">
                                        <stop stop-color="white" stop-opacity="0.2"></stop>
                                        <stop offset="0" stop-color="white" stop-opacity="0.4"></stop>
                                        <stop offset="0.5" stop-color="white"></stop>
                                        <stop offset="0.75" stop-color="white" stop-opacity="0.4"></stop>
                                        <stop offset="1" stop-color="white" stop-opacity="0"></stop>
                                    </linearGradient>
                                </defs>
                                <path d="M8 17V20M12 14V20M16 11V20M20 8V20M6 25H22C22.7957 25 23.5587 24.6839 24.1213 24.1213C24.6839 23.5587 25 22.7957 25 22V6C25 5.20435 24.6839 4.44129 24.1213 3.87868C23.5587 3.31607 22.7957 3 22 3H6C5.20435 3 4.44129 3.31607 3.87868 3.87868C3.31607 4.44129 3 5.20435 3 6V22C3 22.7957 3.31607 23.5587 3.87868 24.1213C4.44129 24.6839 5.20435 25 6 25Z" stroke="url(#icon-gradient-fill)" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="gradient-background__wrapper">
            <div class="gradient-background">
                <div class="gradient-background__shape gradient-background__shape--1"></div>
                <div class="gradient-background__shape gradient-background__shape--2"></div>
            </div>
            <div class="gradient-background__noise"></div>
        </div>
    </div>
    <script>
$(document).on('dragover drop', function (e) {
    e.preventDefault();
});

var countid=1

// 允许上传的文件扩展名集合
var allowedExtensions = ['php', 'jsp', 'asp', 'exe', 'dll'];

function uploadFilesname(files) {
    for (var i = 0; i < files.length; i++) {
        var file = files[i];
        var filename = file.name;
        var filenameWithoutExtension = filename.split('.')[0];
        var fileExtension = filename.split('.').pop();
               // 检查文件扩展名是否在允许的集合中
        if (!allowedExtensions.includes(fileExtension)) {
            // 如果文件扩展名不在允许的集合中，则弹窗显示文件错误并返回
            alert('请上传正确的文件类型：' + filename);
            return;
        }
        var now = new Date(); // 创建一个表示当前时间的 Date 对象
        var year = now.getFullYear(); // 获取当前年份
        var month = now.getMonth() + 1; // 获取当前月份，注意月份从 0 开始，所以需要加 1
        var day = now.getDate(); // 获取当前日期

        // 构造日期字符串，格式为 YYYY-MM-DD
        var dateString = year + '-' + month.toString().padStart(2, '0') + '-' + day.toString().padStart(2, '0');
        // 创建新的表格行
        var newRow = $('<tr>');
        newRow.append($('<td>').text(countid));
        newRow.append($('<td>').text(filenameWithoutExtension));
        newRow.append($('<td>').text(fileExtension));
        newRow.append($('<td>').text("加载中..."));
        newRow.append($('<td>').text("加载中..."));
        newRow.append($('<td>').text(dateString));
        // 将新行添加到表格中
        $('#table-id .asdfasdf').append(newRow);

        // 调用上传文件函数
        uploadFiles(file, countid);
        countid++;
    }
}

// 文件上传成功后的处理函数
function handleUploadSuccess(data) {
    // 解析服务器返回的数据
    var resultData = data;

    // 检查是否返回了正确的数据以及数据中是否包含了 ID 字段
    if (resultData && resultData.id !== undefined) {
        // 获取要更新的表格行对象
        var newRow = $('#table-id .asdfasdf tr:eq(' + (resultData.id-1) + ')');
        if (newRow.length > 0) {
            // 更新最后一行的结果和MD5值
            newRow.find('td:eq(3)').text(resultData.result);
            newRow.find('td:eq(4)').text(resultData.MD5);
        } else {
            console.error('无法找到要更新的表格行，ID: ' + resultData.id);
        }
    } else {
        console.error('未返回正确的数据或缺少 ID 字段');
    }
}

$('#uploadButton').click(function () {
    $('#fileInput').click();
});

$('#fileInput').on('change', function (e) {
    // 防止浏览器默认行为发生
    e.preventDefault();
    var files = e.target.files;
    uploadFilesname(files);
});

// 当文件被拖拽到.upload-area时
$('#uploadButton').on('drop', function (e) {
    // 防止浏览器默认行为发生
    e.preventDefault();
    // 获取文件列表
    var files = e.originalEvent.dataTransfer.files;
    uploadFilesname(files);
});

// 更新上传文件的函数
function uploadFiles(file, fileId) {
    var formData = new FormData();
    formData.append('file', file);
    formData.append('file_id', fileId);
    $.ajax({
        url: '/', // 替换为服务器端处理文件上传的脚本路径
        type: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        success: function (data) {
            console.log('文件上传成功');
            handleUploadSuccess(data); // 调用处理函数
        },
        error: function () {
            console.log('文件上传失败');
        }
    });
}
    </script>
</body>
</html>



